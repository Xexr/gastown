{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-06T08:21:04Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"a041a982d2b8487388deb0bba0325010119db12907e1046e139a8ca0de45a0d3","created_at":"2026-02-05T18:16:40Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"bulk cleanup: wisps and stale non-core issues","deleted_at":"2026-02-06T22:31:02Z","deleted_by":"beads/crew/leeloo","description":"The mol-refinery-patrol formula has a hardcoded run-tests step that always runs tests (currently hardcoded to 'go test ./...'). It does not check the merge_queue.run_tests setting in settings/config.json.\n\nThe run_tests config field is only read by the programmatic 'gt mq integration land' command (getTestCommand() in mq_integration.go), not by the formula-driven refinery agent.\n\nFix options:\n1. Add a {{skip_tests}} or {{test_command}} template variable to the formula, injected at instantiation time from rig config\n2. Have the formula instruct the agent to read settings/config.json before the run-tests step\n3. Make the run-tests step conditional on config\n\nRelated: the formula also hardcodes 'go test ./...' rather than using the configured test_command.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"dypt-d1e","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Refinery formula ignores run_tests config setting","updated_at":"2026-02-06T22:31:02Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":"2026-02-24T12:19:04Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"a041a982d2b8487388deb0bba0325010119db12907e1046e139a8ca0de45a0d3","created_at":"2026-02-05T18:06:27Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"The mol-refinery-patrol formula has a hardcoded run-tests step that always runs tests (currently hardcoded to 'go test ./...'). It does not check the merge_queue.run_tests setting in settings/config.json.\n\nThe run_tests config field is only read by the programmatic 'gt mq integration land' command (getTestCommand() in mq_integration.go), not by the formula-driven refinery agent.\n\nFix options:\n1. Add a {{skip_tests}} or {{test_command}} template variable to the formula, injected at instantiation time from rig config\n2. Have the formula instruct the agent to read settings/config.json before the run-tests step\n3. Make the run-tests step conditional on config\n\nRelated: the formula also hardcodes 'go test ./...' rather than using the configured test_command.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"dypt-x7b","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Refinery formula ignores run_tests config setting","updated_at":"2026-02-24T12:19:04Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c2b14cbcde3b0e08c91880ed751b6b036666b1173a9cc9c0db1a3346aae21665","created_at":"2026-02-25T10:04:19Z","created_by":"gastown/crew/frodo","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Bug\n\n`patrol-molecules-exist` check reports all rigs as missing patrol formulas, even though the formulas exist and patrols run correctly.\n\n## Expected Behavior\n\nThe check should pass when patrol formulas are accessible via the full formula search path (`\u003crigPath\u003e/.beads/formulas/`, `\u003ctownRoot\u003e/.beads/formulas/`, or `~/.beads/formulas/`).\n\n## Actual Behavior\n\nThe check only looks at `\u003crigPath\u003e/.beads/formulas/\u003cformula\u003e.formula.toml` (line 106 of patrol_check.go). It does not search the town-level directory (`\u003ctownRoot\u003e/.beads/formulas/`) where formulas are actually installed by `gt doctor --fix` (the formulas sync check).\n\nResult: all 7 rigs report missing `[mol-deacon-patrol mol-witness-patrol mol-refinery-patrol]` even though those files exist at `~/gt/.beads/formulas/` and the daemon uses them successfully.\n\n## Reproduction\n\n1. Have a standard Gas Town setup with formulas synced at town level\n2. Run `gt doctor -v`\n3. Observe `patrol-molecules-exist` warning for all rigs\n4. Verify formulas exist: `ls ~/gt/.beads/formulas/mol-*patrol*`\n\n## Suggested Fix\n\n`checkPatrolFormulas()` should also check the town-level formulas directory (and optionally `~/.beads/formulas/`) before reporting missing, matching the actual search path used by `bd mol wisp`.\n\n## Environment\n\n- gt version: v0.8.0-164-g18c5b34d\n- bd version: 0.56.1\n- Platform: Linux","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-04z","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"gt doctor: patrol-molecules-exist doesn't search town-level formulas directory","updated_at":"2026-02-25T10:04:19Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Not reproducing currently — will refile if it resurfaces","closed_at":"2026-02-25T11:08:17Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ab41727e9dd5bea10643ea2e9b7bac73d1a5b5d12e28467f05351a2c5b47a774","created_at":"2026-02-11T12:13:53Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"In internal/beads/integration.go:165-172, DetectIntegrationBranch checks local branch existence first. If a local tracking ref exists (e.g. origin/integration/foo), it returns immediately without verifying the remote branch still exists.\n\nReproduction:\n1. Create epic with integration branch: gt mq integration create \u003cepic-id\u003e\n2. Delete remote branch: git push origin --delete integration/\u003cepic-id\u003e\n3. Sling child task: gt sling \u003cchild-id\u003e \u003crig\u003e\n4. Auto-detection finds stale local ref, polecat tracks a dead upstream\n\nResult: Polecat gets 'upstream is gone' warning, has to manually unset upstream.\nExpected: Detection should fallback to main when remote branch is deleted.\n\nRoot cause: Line 166 calls checker.BranchExists() which finds the stale local tracking ref. The remote check on line 175 is never reached because the local check short-circuits.\n\nPossible fixes:\n- Reverse order: check remote first, local as fallback\n- Require both local AND remote to exist\n- Run git fetch --prune before detection\n- Use git ls-remote for authoritative remote check\n\nFile: internal/beads/integration.go:147 (DetectIntegrationBranch)\nDiscovered during integration branch testing (PR #1226).","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-1eq","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Bug: DetectIntegrationBranch uses stale local refs instead of verifying remote","updated_at":"2026-02-25T11:08:17Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T12:19:12Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ecb5e1a92e131b7a1679412e34d0ab2b323b5eab3414b528666d134bc286fadf","created_at":"2026-02-12T18:20:53Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"gt doctor runs 57 checks but none validate that the rig's configured default_branch actually exists as a remote branch. Setting default_branch to a nonexistent branch is only caught at polecat spawn time with a clear error, but gt doctor should catch this proactively as a rig health check.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-1hk","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"gt doctor should check that default_branch exists on remote","updated_at":"2026-02-24T12:19:12Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in PR #1983: https://github.com/steveyegge/gastown/pull/1983","closed_at":"2026-02-24T13:50:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"965f73cb8bbce9c3fd01aa928cdb2ab9f213c1c020707f73d38027270327a6f7","created_at":"2026-02-24T13:05:42Z","created_by":"gastown/crew/gimli","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"The check flags crew on feature branches. Crew legitimately use feature branches for PR workflows. Should exclude crew or detect stale vs active branches. Related: gt-8zb","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-249","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"persistent-role-branches check too aggressive for crew on feature branches","updated_at":"2026-02-24T13:50:58Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"6869af2180cffe08c58e5805bd2d80ab24646f02b77df313c5d6ff43215dff55","created_at":"2026-02-25T09:48:41Z","created_by":"gastown/crew/frodo","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Context\n\nPR #1984 (fix(doctor): detect stale types sentinel in EnsureCustomTypes) was closed\nby Steve as superseded. Main already had a simpler sentinel staleness approach (raw\ntypes list string comparison) that was merged before our PR arrived. Our PR used a\nfingerprint/sha256 format which conflicted with what landed on main.\n\n## What Landed Upstream\n\nUpstream commit `f7439b03` implements stale sentinel detection using `typesFingerprint()`\n— a function that computes a fingerprint from the sorted types list and compares it\nagainst the sentinel file content. This covers the core staleness detection.\n\n## What Steve Invited Us to Submit\n\nFrom the closing comment on #1984:\n\n\u003e The `InvalidateSentinel()` function and the `CreateAgentBead` retry logic from this\n\u003e PR are good ideas — if you'd like to contribute those pieces, a fresh PR rebased on\n\u003e main with just those additions would be welcome.\n\nTwo pieces to extract from our original PR branch (`fix/doctor-agent-beads-silent-failure`):\n\n1. **`InvalidateSentinel()` API** — New exported function for programmatic cache clearing\n   (both in-memory `ensuredDirs` map and on-disk sentinel file). Useful when external\n   code knows types have changed and wants to force reconfiguration.\n\n2. **`CreateAgentBead` retry logic** — Defense-in-depth in `CreateAgentBead`: when\n   `bd create` fails with \"invalid issue type\", invalidate the sentinel, re-run\n   `EnsureCustomTypes`, and retry once. Catches cases where the database state changed\n   after startup.\n\n## Implementation Notes\n\n- Must be rebased on current upstream/main (the fingerprint approach, not our old raw list approach)\n- The `InvalidateSentinel()` function needs to clear the `ensuredDirs` in-memory cache\n  and delete the on-disk sentinel file\n- The `CreateAgentBead` retry should use `IsTypeValidationError()` helper to detect the\n  specific error condition\n- Tests from original PR: `TestInvalidateSentinel`, `TestIsTypeValidationError` can be\n  adapted for the new base\n- Original PR branch: `fix/doctor-agent-beads-silent-failure` (still on origin)\n\n## References\n\n- Upstream PR: https://github.com/steveyegge/gastown/pull/1984\n- Original branch: `origin/fix/doctor-agent-beads-silent-failure`\n- Upstream sentinel implementation: commit f7439b03","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-274","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Submit InvalidateSentinel() and CreateAgentBead retry logic as fresh upstream PR","updated_at":"2026-02-25T09:48:41Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96613891882864789e36239e95eeb89db9c6916060de90bd5e0adddee7d47aab","created_at":"2026-02-26T07:58:52Z","created_by":"","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Bug\n\n`gt doctor` reports 20 agent beads as missing the `gt:agent` label, but all 20 already have it.\n\n## Expected Behavior\n\n`agent-beads-exist` check should pass when agent beads exist and have the `gt:agent` label.\n\n## Actual Behavior\n\nCheck reports \"20 agent bead(s) missing gt:agent label\" as a warning. `--fix` runs but changes nothing (because nothing is wrong). Verified with `bd show \u003cid\u003e --json` — every listed bead has `labels: [\"gt:agent\"]`.\n\nAffected beads span all rigs: xr-xexrcom-witness, xr-xexrcom-refinery, bd-beads-witness, bd-beads-refinery, gt-gastown-crew-{aragorn,frodo,gandalf,gimli,legolas}, ox-onyx-{witness,refinery,crew-burry}, tk-toolkit-{witness,refinery,crew-watney}, mp-marketplace-{witness,refinery,crew-valentine}.\n\n## Reproduction\n\n1. Multi-rig town with agent beads across 6+ rigs\n2. Run `gt doctor -v`\n3. Observe `agent-beads-exist` warning listing beads that already have the label\n\n## Workaround\n\nNone needed — the warning is cosmetic. The label already exists.\n\n## Environment\n\n- gt version: v0.8.0-229-ge971ef24\n- bd version: 0.56.1\n- Platform: Linux 6.17.0-14-generic","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-2g8","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"gt doctor: agent-beads-exist reports false positive — beads already have gt:agent label","updated_at":"2026-02-26T07:59:09Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"gastown/crew/gandalf","await_id":"","await_type":"","close_reason":"Fixed in PR #1980: https://github.com/steveyegge/gastown/pull/1980","closed_at":"2026-02-24T12:46:54Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"8fba99c3ef94700c0bd98e28f889da2bce66cf56afc0566492d336ac72b676d3","created_at":"2026-02-23T13:05:01Z","created_by":"","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Bug\n\nThe `patrol-not-stuck` doctor check reads from `issues.jsonl` (file-based export in `.beads/`) instead of querying the Dolt database. When wisps are compacted or deleted from Dolt, ghost entries remain in the JSONL file, causing the doctor to report stuck wisps that no longer exist.\n\n## Root Cause\n\n`internal/doctor/patrol_check.go:235` — `checkStuckWisps()` reads from `beads.ResolveBeadsDir(rigPath) + /issues.jsonl`. In Dolt server mode, the JSONL is an export/cache file that can become stale. The canonical data is in the Dolt database.\n\n## Expected Behavior\n\nIn Dolt server mode (`metadata.json` has `dolt_mode: server`), the check should query the Dolt database directly instead of reading the JSONL file.\n\n## Actual Behavior\n\nDoctor reports `dypt-mol-cr5` as stuck since 2026-02-18, but:\n- `bd show dypt-mol-cr5` → not found\n- `dolt sql -q \"SELECT ... FROM dypt.issues WHERE id = 'dypt-mol-cr5'\"` → no rows\n- `dolt sql -q \"SELECT ... FROM dypt.wisps WHERE id LIKE '%cr5%'\"` → no rows\n- The entry only existed in the stale `issues.jsonl` file\n\n## Workaround\n\nManually remove the stale line from `issues.jsonl`:\n```bash\ngrep -v 'dypt-mol-cr5' .beads/issues.jsonl \u003e /tmp/fixed.jsonl \u0026\u0026 cp /tmp/fixed.jsonl .beads/issues.jsonl\n```\n\n## Environment\n\n- gt version: 0.8.0 (faf45d1c)\n- Dolt server mode on port 3307","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-2o6","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"gt doctor: patrol-not-stuck reads stale issues.jsonl instead of Dolt DB","updated_at":"2026-02-24T12:46:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in PR #1988: https://github.com/steveyegge/gastown/pull/1988","closed_at":"2026-02-24T15:18:33Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"1a9270cf8e79d7783cb9a911fb3f0dd54f590378f39c02b270b1586fd78fd71d","created_at":"2026-02-24T12:12:39Z","created_by":"","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Bug\n\nWhen the daemon creates/restarts sessions for certain roles (marketplace/{witness,refinery}, xexrcom/{witness,refinery}), the generated Claude `settings.json` SessionStart hooks do not include `gt prime`. `gt doctor --fix` resolves this by fixing priming, but the next daemon restart recreates sessions without the hook.\n\n## Expected Behavior\n\nAll Gas Town sessions should have `gt prime` in their SessionStart hook so that crew/witness/refinery roles get proper context on startup.\n\n## Actual Behavior\n\n4 sessions consistently lack `gt prime` in SessionStart:\n- marketplace/witness\n- marketplace/refinery\n- xexrcom/witness\n- xexrcom/refinery\n\n`--fix` reports 'Priming subsystem is correctly configured (fixed)' but next verification shows them missing again.\n\n## Reproduction\n\n1. Run `gt doctor --fix --restart-sessions`\n2. Verify priming shows fixed\n3. Run `gt doctor -v` — 4 priming issues reappear\n\n## Workaround\n\nNone — the cycle repeats.\n\n## Environment\n\n- gt version: v0.8.0-58-g9f0902c2\n- bd version: 0.56.1 (28c406d5)\n- Platform: Linux 6.17.0-14-generic","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-2wr","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"gt doctor --fix: session creation omits gt prime from SessionStart hooks (fix/recreate cycle)","updated_at":"2026-02-24T15:18:33Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Migrated 4 remaining callsites to Label: gt:merge-request. Commit c1ee17ec.","closed_at":"2026-02-13T09:59:41Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"885b2128ee5172c4c1919097eb9209ceae3c90dedea8db5010d6c2affad02aa5","created_at":"2026-02-13T09:24:58Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"PR #3 (MT-1) migrated 2 callsites in mq_integration.go from Type: \"merge-request\" to Label: \"gt:merge-request\". 4 query-side callsites still use the deprecated pattern:\n\n1. internal/cmd/mq_list.go:31\n2. internal/cmd/mq_next.go:63\n3. internal/cmd/status.go:1180\n4. internal/refinery/manager.go:224\n\nNote: mq_submit.go:196 and done.go:511 use CreateOptions.Type (not ListOptions.Type) -- different struct, not part of this migration.\n\nBoth patterns produce identical bd CLI commands (beads.List translates Type to --label), so this is code hygiene not a bug fix. But having a mix of patterns is confusing for future readers.\n\nMay or may not go in PR #1226 -- awaiting decision.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-4sk","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Complete Type to Label migration for MR bead queries","updated_at":"2026-02-13T09:59:41Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"64d638473a370baa9f1bf26c3feae586d3351bb7866ecc1fe4890b367941d7b5","created_at":"2026-02-26T08:34:55Z","created_by":"gastown/refinery","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-5yy","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"--help","updated_at":"2026-02-26T08:34:55Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Root cause confirmed and fixed: Status:\"\" excluded closed MRs. Added --limit=0 to prevent silent truncation. Fixed mock fidelity + regression test.","closed_at":"2026-02-13T11:10:30Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"7b06d572872cd69ae6eee90b149860a02a4c39e00ceb512d744ec25cbbef4d35","created_at":"2026-02-13T09:31:34Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Root Cause: CONFIRMED BUG\n\n### Bug 1 (Primary): Missing --status=all in MR query\n\n**File**: `internal/cmd/mq_integration.go:840-843`\n\n```go\nallMRs, err := bd.List(beads.ListOptions{\n    Label:  \"gt:merge-request\",\n    Status: \"\", // WRONG - comment says 'all statuses' but bd defaults to open-only\n})\n```\n\n**What happens**: When `Status: \"\"` is passed to `beads.List`, no `--status` flag is passed to `bd list`. The `bd` CLI defaults to showing only non-closed issues (open + in_progress + blocked). Closed (merged) MRs are silently excluded.\n\n**Impact**: `gt mq integration status` never shows merged MRs. If all MRs have been merged, it shows 0 MRs total.\n\n**Fix**: Change `Status: \"\"` to `Status: \"all\"` on line 842.\n\n**Irony**: The children query at line 874 (30 lines later!) correctly uses `Status: \"all\"`.\n\n### Bug 2 (Secondary): Missing --limit=0 (default caps at 50)\n\n`beads.ListOptions` has no `Limit` field. The `bd list` default is 50 results. Any integration with 50+ MRs would silently truncate.\n\n### Bug 3 (Mock divergence): Test mock doesn't reproduce bd's default filter\n\n`mockBeads.List` (mq_testutil_test.go:50) treats `Status: \"\"` as 'return all', which hides Bug 1 in unit tests. Real `bd` treats no --status flag as 'open only'.\n\n### Reproduction\n\nCreated 5 test MRs with labels `gt:merge-request`:\n- 1 open, 1 in_progress, 1 blocked, 2 closed\n\nResults:\n- `bd list --json --label=gt:merge-request` → 3 results (no closed)\n- `bd list --json --label=gt:merge-request --status=all` → 5 results (all)\n- After closing all MRs: default returns 0 matching, --status=all returns all 4\n\n### Affected code path\nOnly `runMqIntegrationStatus` (line 840). `findOpenMRsForIntegration` correctly uses `Status: \"open\"`.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-6ck","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Investigate root cause of 0 MRs in gt mq integration status (MT-1 symptom unresolved)","updated_at":"2026-02-13T11:10:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"gastown/crew/gimli","await_id":"","await_type":"","close_reason":"Fixed in PR #1985: https://github.com/steveyegge/gastown/pull/1985","closed_at":"2026-02-24T14:13:24Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"6d07a43b8db5e405f64f715b32e490a2c29f24b3ed0ce9ff3ce3b13d44fa9381","created_at":"2026-02-13T14:02:04Z","created_by":"deacon","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"Bug in internal/config/loader.go:roleSettingsDir(). For refinery role, it returns rigPath/refinery but the actual working directory and settings location is rigPath/refinery/rig. This causes --settings to point Claude to a non-existent file, making Claude exit immediately on startup. The gt rig start command reports success because NewSessionWithCommand creates the tmux session, WaitForRuntimeReady returns before Claude exits, and by the time Start() returns nil the session is already dead. Workaround: copy settings.local.json to rigPath/refinery/.claude/. Fix: roleSettingsDir should return rigPath/refinery/rig for the refinery role, or the withRoleSettingsFlag logic should account for the /rig/ subdirectory.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-78j","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"roleSettingsDir returns wrong path for refinery - missing /rig/ suffix","updated_at":"2026-02-24T14:13:24Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-26T08:52:32Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"124a0a029be009ffe4e21afff1dd93040d76125da01b0d5facf9d3eed1743dfc","created_at":"2026-02-26T08:27:57Z","created_by":"gastown/crew/gandalf","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"base_branch: main\nintegration_branch: integration/polecat-smoke-test","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-7we","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Polecat smoke test","updated_at":"2026-02-26T08:52:32Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"466cf96486f6ff6d5068dc9335d4158ffbd8ce18f6769be8b2abaf4d6820c90c","created_at":"2026-02-19T12:21:27Z","created_by":"mayor","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"When adding a rig from a repo that does NOT have a tracked .beads/ directory, the dolt_database field in metadata.json ends up with the wrong value, breaking Dolt connectivity.\n\nRoot cause: execution order conflict between doltserver.InitRig and bd init --server in manager.go:AddRig.\n\n1. doltserver.InitRig (manager.go:485) creates a Dolt database named after the rig (e.g. 'toolkit')\n2. InitBeads (manager.go:765) runs 'bd init --prefix tk --server' which writes dolt_database: 'beads_tk' to metadata.json (init.go:457 uses 'beads_' + prefix convention)\n3. EnsureMetadata (doltserver.go:1570) only sets dolt_database as a fallback when nil/empty — since bd init already set it to 'beads_tk', it does not override\n4. Result: metadata.json says dolt_database: 'beads_tk' but actual database is 'toolkit' — bd cannot connect\n\nThe seeded path (repo has .beads/ with correct metadata.json) avoids this because InitBeads creates a redirect instead of running bd init, so the correct dolt_database is never overwritten.\n\nFix options:\n- Option A: Make EnsureMetadata forcefully set dolt_database=rigName after InitBeads (not just as fallback)\n- Option B: Pass the correct database name to bd init so it writes the right value\n- Option C: Re-order so EnsureMetadata runs AFTER bd init and always overrides dolt_database\n\nCurrent workaround: Seed .beads/ in the upstream repo before running gt rig add (documented in gastown-rig-setup skill).","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-7y87","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"gt rig add: unseeded repos get wrong dolt_database name in metadata.json","updated_at":"2026-02-19T12:21:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"gastown/polecats/slit","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-26T08:37:50Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dc2d51c91b0cb1ab7103bcf844f06eddaec766261a43b272a413e2375eeedb24","created_at":"2026-02-26T08:33:29Z","created_by":"gastown/crew/gandalf","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Task\n\nCreate a file at `TEST_DOCS/test5.md` in the repo root with the following content:\n\n```markdown\n# Polecat Smoke Test 5\n\n- **Date:** (current date/time)\n- **Agent:** (your agent identity)\n- **Status:** PASS\n\nThis file was created by a polecat to verify the dispatch-execute-merge pipeline works end-to-end.\n```\n\n## Acceptance Criteria\n\n1. `TEST_DOCS/test5.md` exists and contains the above content (with actuals filled in)\n2. File is committed to the feature branch\n3. `gt done` is called to submit to refinery","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-8e0","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"Implemented: Created TEST_DOCS/test5.md with polecat smoke test results (date, agent identity, PASS status)","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Create TEST_DOCS/test5.md with polecat smoke test results","updated_at":"2026-02-26T08:54:43Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"","await_id":"","await_type":"","close_reason":"Completed with no code changes (already fixed or pushed directly to main)","closed_at":"2026-02-26T08:46:55Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9283abd3fe1175bf250f95d55214df9d09dfca7aae59f8282a808ecd5abe6daa","created_at":"2026-02-26T08:33:29Z","created_by":"gastown/crew/gandalf","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Task\n\nCreate a file at `TEST_DOCS/test4.md` in the repo root with the following content:\n\n```markdown\n# Polecat Smoke Test 4\n\n- **Date:** (current date/time)\n- **Agent:** (your agent identity)\n- **Status:** PASS\n\nThis file was created by a polecat to verify the dispatch-execute-merge pipeline works end-to-end.\n```\n\n## Acceptance Criteria\n\n1. `TEST_DOCS/test4.md` exists and contains the above content (with actuals filled in)\n2. File is committed to the feature branch\n3. `gt done` is called to submit to refinery","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-8um","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Create TEST_DOCS/test4.md with polecat smoke test results","updated_at":"2026-02-26T08:46:55Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"gastown/crew/gimli","await_id":"","await_type":"","close_reason":"Fixed in PR #1982: https://github.com/steveyegge/gastown/pull/1982","closed_at":"2026-02-24T13:08:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"f98ae021a8f35934a5ea37fd1333a76f3be625d7d90d8df15f040480b7ab45ec","created_at":"2026-02-23T13:04:46Z","created_by":"","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Bug\n\n`gt doctor --fix` for `persistent-role-branches` silently fails when the target branch (main) is already checked out in the bare repo (`.repo.git`). In a worktree setup, two worktrees cannot have the same branch checked out.\n\n## Expected Behavior\n\nEither:\n1. Detect the worktree conflict and report it clearly, OR\n2. Handle it by moving the bare repo's HEAD to a placeholder branch first\n\n## Actual Behavior\n\n`--fix` reports attempting the fix but the warning persists. No error message explains why. The user must manually:\n1. Create a placeholder branch in the bare repo\n2. `git symbolic-ref HEAD refs/heads/\u003cplaceholder\u003e`\n3. Then checkout main in the worktree\n\n## Reproduction\n\n1. Have a rig with worktrees where `.repo.git` has `main` checked out\n2. Have a worktree (e.g. refinery/rig) on a different branch\n3. Run `gt doctor --fix`\n4. persistent-role-branches warning persists silently\n\n## Environment\n\n- Observed on dypt rig (bare repo at `.repo.git` had main, refinery/rig on integration/ai-template-recommender)\n- gt version: 0.8.0 (faf45d1c)","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-8zb","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"gt doctor --fix: persistent-role-branches silently fails for worktree branch conflicts","updated_at":"2026-02-24T13:08:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"gastown/crew/frodo","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T14:04:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"29495c144386e628192dc4741e9433b4dcfe644b96540663920fcbd8f0c0f6d6","created_at":"2026-02-23T13:04:32Z","created_by":"","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Bug\n\n`gt doctor --fix` deletes 9 stale Claude settings.json files (missing PATH export), but also starts the daemon as part of the fix. The daemon restart recreates the settings files in their stale state, so the next doctor run finds them stale again.\n\n## Expected Behavior\n\nAfter `--fix`, the settings files should either:\n1. Not be recreated by the daemon restart, OR\n2. Be recreated with correct content (including PATH export)\n\n## Actual Behavior\n\nFix cycle: delete stale files → daemon restarts → daemon recreates stale files → next doctor run finds them stale again.\n\nThe workaround is `gt doctor --fix --restart-sessions` which deletes and recreates properly. But the doctor hint text says `gt up --restart` which doesn't exist (see gt-99v).\n\n## Reproduction\n\n1. Have rigs with stale settings (e.g. marketplace, xexrcom, events)\n2. Run `gt doctor --fix`\n3. Run `gt doctor` again — claude-settings still fails\n\n## Environment\n\n- gt version: 0.8.0 (faf45d1c)\n- Platform: Linux","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-99u","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"gt doctor --fix: claude-settings fix races with daemon restart","updated_at":"2026-02-24T14:04:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"a0000d260e35bbf52759f757eabefe0bd5b37f2b4113c07b02b13464ea3ae2b2","created_at":"2026-02-26T07:37:09Z","created_by":"gastown/crew/gandalf","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-9hb","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"--help","updated_at":"2026-02-26T07:37:09Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"gastown/polecats/nux","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-26T08:37:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"45cc99fa7dd7a39bd8465b66ff995c71e28c6cddf9592a8f537e0d122a79b0e9","created_at":"2026-02-26T08:33:29Z","created_by":"gastown/crew/gandalf","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Task\n\nCreate a file at `TEST_DOCS/test2.md` in the repo root with the following content:\n\n```markdown\n# Polecat Smoke Test 2\n\n- **Date:** (current date/time)\n- **Agent:** (your agent identity)\n- **Status:** PASS\n\nThis file was created by a polecat to verify the dispatch-execute-merge pipeline works end-to-end.\n```\n\n## Acceptance Criteria\n\n1. `TEST_DOCS/test2.md` exists and contains the above content (with actuals filled in)\n2. File is committed to the feature branch\n3. `gt done` is called to submit to refinery","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-9io","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"Implemented: Created TEST_DOCS/test2.md with polecat smoke test results (date, agent identity, PASS status)","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Create TEST_DOCS/test2.md with polecat smoke test results","updated_at":"2026-02-26T08:54:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"gastown/polecats/furiosa","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-26T08:33:41Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b7c13c598864766cbded34b92adae0b84d9f459669b00ad29c7c9200bbf82b8","created_at":"2026-02-26T08:28:04Z","created_by":"gastown/crew/gandalf","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Task\n\nCreate a file at `TEST_DOCS/test.md` in the repo root with the following content:\n\n```markdown\n# Polecat Smoke Test\n\n- **Date:** (current date/time)\n- **Agent:** (your agent identity)\n- **Status:** PASS\n\nThis file was created by a polecat to verify the dispatch-execute-merge pipeline works end-to-end.\n```\n\n## Acceptance Criteria\n\n1. `TEST_DOCS/test.md` exists and contains the above content (with actuals filled in)\n2. File is committed to the feature branch\n3. `gt done` is called to submit to refinery","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-b6t","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Create TEST_DOCS/test.md with polecat smoke test results","updated_at":"2026-02-26T08:54:32Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Exported DeprecatedMergeQueueKeys from config, doctor now imports it. Commit d1e36649.","closed_at":"2026-02-13T09:53:26Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"a9122967e486c95b2e21f5335127271fea829eb9ecd65342bcf668167a2c08d5","created_at":"2026-02-13T09:26:17Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"Both config/loader.go:296 and doctor/deprecated_config_check.go:13 define var deprecatedMergeQueueKeys = []string{\"target_branch\", \"integration_branches\"}.\n\nFix: export DeprecatedMergeQueueKeys from the config package and reference it from the doctor check. Single source of truth.\n\nFlagged during PR #7 review (R4-1). Must fix before final squash.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-bvx","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix duplicate deprecatedMergeQueueKeys variable across config and doctor packages","updated_at":"2026-02-13T09:53:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"43b8cba50a08a79b8287ed605124f8074e70887b42c2124d24b7e843964fb22e","created_at":"2026-02-26T07:58:53Z","created_by":"","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Bug\n\n`gt doctor` misclassified-wisps check reports \"some DB probes failed\" but doesn't identify which databases failed or why.\n\n## Expected Behavior\n\nWhen DB probes fail, the check should report which specific databases/rigs were unreachable and surface the error. Should also retry or fall back gracefully rather than producing an inconclusive warning.\n\n## Actual Behavior\n\nWarning: \"No misclassified wisps found (some DB probes failed)\" — no detail on which probes failed. All databases are confirmed reachable via `bd list` commands to each rig. The probe failure appears transient or the check is using a different connectivity path than normal bd operations.\n\n## Reproduction\n\n1. Multi-rig town with 6+ rigs\n2. Run `gt doctor -v`\n3. Observe misclassified-wisps warning with no detail on which probes failed\n\n## Workaround\n\nNone needed — warning is informational. Verify DB connectivity with `bd list --limit 1` per rig manually.\n\n## Environment\n\n- gt version: v0.8.0-229-ge971ef24\n- bd version: 0.56.1\n- Platform: Linux 6.17.0-14-generic","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-c9b","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"gt doctor: misclassified-wisps check fails silently on DB probe errors","updated_at":"2026-02-26T07:59:13Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"68a1f526a12ff0608c15e6f005440355b538a0c57becc0f15d5d4c2ba33a3c78","created_at":"2026-02-11T12:06:20Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"The dypt rig's witness and refinery were both running but had no agent beads (gt:agent label) in the dypt beads database. This caused mail routing failures:\n\n  Error: invalid recipient \"dypt/witness\": no agent found\n  Error: Could not read agent bead: no issue found matching \"gt-dypt-refinery\"\n\nBoth processes run fine (state.json, patrols active) but the mail router validates recipients by querying agent beads. Without the beads:\n- gt done and refinery can't notify the witness (MERGED/WORK_DONE mails fail)\n- gt mol step await-signal can't read/persist backoff state for refinery\n\nInvestigate:\n- How are agent beads supposed to be created? (gt up? witness startup? bd init?)\n- Is this a gap in rig setup, or were the beads deleted/never created for dypt?\n- Should witness/refinery self-register on startup if their agent bead is missing?\n- Check if gastown rig has the same issue or if it was set up differently\n- Check other rigs too (beads, any others)\n\nWorkarounds applied:\n- Manually created dypt-p5v8 as the witness agent bead for dypt\n- Manually created dypt-74il as the refinery agent bead for dypt\n\nFiles to check:\n- internal/cmd/up.go (rig startup)\n- internal/witness/start.go or similar\n- internal/rig/setup.go or similar\n- internal/mail/router.go:716 (validateRecipient)\n- internal/cmd/mol_step.go (await-signal agent-bead lookup)","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-co5","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Investigate: witness agent bead creation during rig setup","updated_at":"2026-02-11T12:09:22Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"gastown/crew/frodo","await_id":"","await_type":"","close_reason":"Fixed in PR #2017: https://github.com/steveyegge/gastown/pull/2017","closed_at":"2026-02-25T10:59:56Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"00cb99787010bab6e590c10845527d57700e305386cfc5829bf5e164da8a7639","created_at":"2026-02-25T10:40:12Z","created_by":"gastown/crew/frodo","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"dispatched_by: gastown/crew/frodo\n\n## Summary\n\nPR #1985 (fix(config): refinery settings path wrong in RoleSettingsDir and hooks subsystem) moved refinery Claude settings from the parent directory (refinery/.claude/) into the user's repo worktree (refinery/rig/.claude/). This violated the upstream invariant that infrastructure files are kept out of user repos. The PR should be reverted.\n\n## Root Cause Analysis\n\nThe original bead gt-78j (filed 2026-02-13 by deacon, P1) reported that RoleSettingsDir returned the wrong path for refinery, claiming this caused Claude to exit on startup. The symptom was real at the time but the diagnosis was wrong — the actual problem was a fix/recreate cycle in gt doctor where settings were being regenerated with incorrect content, not installed at the wrong location.\n\nThree PRs landed on 2026-02-24 that fixed the actual root causes:\n\n1. **PR #1987** (fix(hooks): backfill DefaultBase into stale on-disk hooks-base.json) — fixed gt-y22: settings.json regenerated without PATH exports\n2. **PR #1988** (fix(doctor): make no_prime_hook fixable in priming check) — fixed gt-2wr: SessionStart hooks missing gt prime after fix cycle  \n3. **PR #1989** (fix(doctor): claude-settings check runs before daemon to prevent race) — fixed the ordering race: doctor deletes stale settings, daemon recreates them stale before doctor can regenerate correct content\n\nBy the time gimli picked up gt-78j on 2026-02-24, these three PRs had already resolved the underlying issue. But the bead was already filed as a location problem, so gimli executed the fix as described — changing RoleSettingsDir to return refinery/rig/ and updating the hooks subsystem and doctor checks to match.\n\n## Verification\n\nLocal testing with the pre-PR code (RoleSettingsDir returning refinery/) confirms:\n\n- Refinery starts and completes full patrol cycles with zero errors\n- settings.json at refinery/.claude/ is correctly found via --settings flag\n- settings.local.json is never created (refinery uses --dangerously-skip-permissions)\n- gt doctor passes cleanly for refinery (only unrelated CLAUDE.md identity anchor issue remains)\n- gt hooks sync correctly creates settings at refinery/.claude/\n\n## What to Revert\n\nPR #1985 touched 10 files. The revert needs to restore:\n\n| File | Revert |\n|------|--------|\n| internal/config/loader.go | RoleSettingsDir: refinery case back to filepath.Join(rigPath, role) |\n| internal/config/loader_test.go | Remove TestRoleSettingsDir (or update expected refinery path) |\n| internal/hooks/config.go | DiscoverTargets: refinery back to parent dir |\n| internal/hooks/config_test.go | Update test expectation |\n| internal/cmd/hooks_install.go | determineTargets + resolveSettingsTarget: refinery back to parent dir |\n| internal/cmd/hooks_test.go | Update resolveSettingsTarget test |\n| internal/cmd/rig_integration_test.go | Restore refinery stale-settings expectations |\n| internal/doctor/claude_settings_check.go | Swap correct/stale paths back |\n| internal/doctor/claude_settings_check_test.go | Update 4 test cases |\n| internal/doctor/config_check.go | Update refinery settings path |\n\n## Acceptance Criteria\n\n- [ ] All RoleSettingsDir, DiscoverTargets, determineTargets, resolveSettingsTarget return refinery/ (parent dir) for refinery role\n- [ ] Doctor considers refinery/.claude/settings.json as correct location\n- [ ] Doctor considers refinery/rig/.claude/ files as stale (wrong location)\n- [ ] gt hooks sync creates settings at refinery/.claude/\n- [ ] Refinery starts and runs patrol successfully\n- [ ] go test ./... passes\n- [ ] gt doctor passes (excluding unrelated CLAUDE.md identity anchor issue gt-x39)\n- [ ] Submit as upstream PR to steveyegge/gastown\n\n## Related\n\n- gt-78j: original (misdiagnosed) bead — closed as fixed by PR #1985\n- gt-y22: fix/recreate cycle (PATH exports) — fixed by PR #1987\n- gt-2wr: fix/recreate cycle (gt prime hooks) — fixed by PR #1988\n- PR #1989: doctor/daemon race condition fix\n- gt-x39: CLAUDE.md identity anchor issue (unrelated, not affected by this revert)","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-dhx","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Revert PR #1985: restore parent-directory settings invariant for refinery role","updated_at":"2026-02-25T10:59:56Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed upstream: commit bd3a75eb (2026-02-22) 'stabilize flaky TestIsAgentRunning and brittle refinery tests' directly addresses both named tests.","closed_at":"2026-02-23T16:14:03Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"d28f5d16afd2558933e51f5bd8a25184d0b448f7ff97aedbe702354aad03c1e6","created_at":"2026-02-13T14:50:18Z","created_by":"gastown/refinery","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"Multiple tmux tests are flaky when run as part of the full test suite (go test ./...) but pass reliably when run in isolation.\n\nObserved failures:\n- TestEnsureSessionFresh_ZombieSession: expected IsAgentRunning to be false for a fresh shell session\n- TestIsAgentRunning/multiple_process_names_with_match: returns false, want true\n\nBoth pass with: go test github.com/steveyegge/gastown/internal/tmux -run \u003ctest\u003e -count=1\n\nLikely cause: tmux session state pollution from parallel test execution or shared session names.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-e4k","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Flaky tmux tests: TestEnsureSessionFresh_ZombieSession and TestIsAgentRunning fail in full suite but pass in isolation","updated_at":"2026-02-23T16:14:03Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Cannot reproduce with bd 0.56.1 — bd ready --parent correctly filters to descendants only. Likely fixed by upstream bd updates since Feb 20.","closed_at":"2026-02-23T16:21:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"806fe20838422bf0ca4cd3348fd99d84fd04818cba2715a287600f223191d6fa","created_at":"2026-02-20T12:35:16Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Summary\n\nWhen running `bd ready --parent dypt-d6t.4`, results include beads that are not descendants of `dypt-d6t.4`. For example, `dypt-9ujpu` (Install npm dependencies) appeared in results despite being an unrelated P1 task elsewhere in the rig.\n\n## Expected Behavior\n\n`--parent` flag on `bd ready` should filter results to only descendants of the specified bead/epic, matching the help text: 'Filter to descendants of this bead/epic'.\n\n## Observed Behavior\n\nResults include beads from the broader rig that are not children or descendants of the specified parent. The crew member had to manually filter results by ID prefix to find the correct tasks.\n\n## Steps to Reproduce\n\n1. Have a rig with multiple epics and ready tasks across different epics\n2. Run `bd ready --parent \u003cepic-id\u003e --json`\n3. Observe that results include beads not under the specified epic\n\n## Context\n\nDiscovered during epic-delivery skill execution on dypt rig. The skill dispatches waves of work to polecats based on `bd ready --parent` results — incorrect filtering could cause wrong tasks to be slung.\n\n## Investigation Notes\n\n- Check if `--parent` on `bd ready` uses the same filtering logic as `bd list --parent`\n- May be a regression or the filter may not be wired up correctly in the GetReadyWork API path","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-e6o","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"bd ready --parent returns results outside the specified epic's subtree","updated_at":"2026-02-23T16:21:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Added multi-rig test with clean + dirty rig. Commit 543ecd23.","closed_at":"2026-02-13T09:55:08Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dfbae2ef8001f962e363ec916d76913a573cd66e22eaf163af14a4d825322f9b","created_at":"2026-02-13T09:26:20Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"All 7 tests in deprecated_config_check_test.go use a single rig. The Run() method iterates over findAllRigs() and aggregates across rigs, but this multi-rig aggregation path is untested.\n\nAdd a test with 2 rigs (one clean, one with deprecated keys) to verify the counting logic in the status message (\"Found deprecated merge_queue keys in N rig(s)\").\n\nFlagged during PR #7 review (R4-1). Must fix before final squash.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-e7w","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Add multi-rig test for DeprecatedMergeQueueKeysCheck","updated_at":"2026-02-13T09:55:08Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in PR #1990: https://github.com/steveyegge/gastown/pull/1990","closed_at":"2026-02-24T15:46:06Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9b802ff8b384d734bb6afed09baf534375d88cb5bceedd117d7ae33c3cf09b28","created_at":"2026-02-24T15:40:13Z","created_by":"gastown/crew/gandalf","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-egw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Add --no-start flag to gt doctor --fix to suppress daemon/agent startup","updated_at":"2026-02-24T15:46:06Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Not reproducing currently — will refile if it resurfaces","closed_at":"2026-02-25T11:06:20Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"658fe432218d08f8f36f3bac92976716fe8ffcdb9d25d4e6e8a500324b5c2856","created_at":"2026-02-20T13:28:57Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Summary\n\nDuring epic delivery of dypt-d6t.4, multiple polecats exited without completing their lifecycle — they pushed code to branches but never called `gt done`, so no MR was submitted to the merge queue. In some cases, polecats exited with no work produced at all.\n\n## Expected Behavior\n\nPolecats should always complete their molecule workflow: implement → push → `gt done` → MR submitted. If a polecat encounters an error, it should fail visibly (bead remains in_progress, error state recorded) rather than silently exiting.\n\n## Observed Behavior\n\nThree categories of failure during one epic delivery:\n\n### Category 1: Code pushed, no MR (2 tasks)\n- dypt-d6t.4.2.2 (rate limiting) — chrome pushed commit 4a061fb1 to branch but exited without gt done\n- dypt-d6t.4.3.2 (loading skeleton) — guzzle pushed commit c40540a4 to branch but exited without gt done\n\nBoth had substantive, complete implementations that passed review. The crew member had to manually submit MRs via gt mq submit --branch ... --issue ... --epic ... --no-cleanup.\n\n### Category 2: No work produced (3 tasks)\n- dypt-d6t.4.4.2 (AI menu) — rust exited with no branch\n- dypt-d6t.4.5.1 (immediate apply) — nitro exited with no branch\n- dypt-d6t.4.5.2 (replace/append) — guzzle exited with no branch\n\nThe deacon eventually respawned these tasks to fresh polecats.\n\n## Impact\n\n- Completed work is wasted if not detected (deacon respawns = re-implementation from scratch)\n- Crew member must manually check for orphaned branches and submit MRs\n- Dependent tasks remain blocked longer than necessary\n- 5/12 tasks (42%) failed in a single epic delivery run\n\n## Investigation Notes\n\n- Check polecat mol-polecat-work molecule — is gt done step being reached?\n- Check for crash/timeout conditions that could cause early exit\n- Related: gt-k4r (polecats closing beads instead of refinery) — different failure mode but same polecat lifecycle area\n- The polecats that failed with code may have timed out or hit context limits during the gt done step","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-fa3","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Polecats exiting without calling gt done — code on branch but no MR submitted","updated_at":"2026-02-25T11:06:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed upstream — land now checks epic children status before proceeding","closed_at":"2026-02-19T23:04:05Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"8b819c8c59ee96f325a9bb20aeeb927c6c456e365245c724e81a4b33833a8c2b","created_at":"2026-02-12T18:15:29Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"Land command only guards on open MRs targeting the integration branch. It does NOT check whether epic children are still open or in_progress. This allows landing while polecats are actively working, orphaning them when the integration branch gets deleted. The --force flag is effectively a no-op since the default path doesn't block on children status. Fix: check epic children status (like gt mq integration status already does) and refuse to land unless all children are closed, unless --force is passed.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-gc3","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"gt mq integration land should check children status, not just open MRs","updated_at":"2026-02-19T23:04:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"gastown/crew/legolas","await_id":"","await_type":"","close_reason":"Fixed in PR #1981: https://github.com/steveyegge/gastown/pull/1981","closed_at":"2026-02-24T12:50:59Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c5538b50632665368a6f05b1156a286cd0bfc0316856b1ec1acc9e637b971b1b","created_at":"2026-02-24T12:12:41Z","created_by":"","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Bug\n\n`gt doctor` reports 'stale-beads-redirect' for all xexrcom polecat directories (27 polecats), and `--fix` resolves it temporarily, but the issue recurs on the next doctor run.\n\nThe root cause appears to be that polecat worktree directories have a nested structure where `.beads/` is inside a subdirectory rather than at the clone root:\n\n```\nxexrcom/polecats/ace/           ← doctor expects .beads/ redirect here\nxexrcom/polecats/ace/xexrcom/   ← actual worktree with .beads/ is here\n```\n\nDoctor's `stale-beads-redirect` check looks for `.beads/` at the polecat clone root level, doesn't find it, and reports 'missing redirect'. The fix creates something at the root level but it doesn't persist or match the actual structure.\n\n## Expected Behavior\n\nDoctor should account for the nested worktree structure of polecats (where the git worktree checkout creates a subdirectory matching the repo name), or the fix should create a durable redirect that survives across runs.\n\n## Actual Behavior\n\nEvery `--fix` pass reports 'stale-beads-redirect: No stale beads files or redirect issues found (fixed)' but the next verification shows 15-27 'missing redirect' entries for xexrcom/polecats/*.\n\n## Reproduction\n\n1. Have an xexrcom rig with polecats\n2. Run `gt doctor -v` — observe stale-beads-redirect warnings for all polecats\n3. Run `gt doctor --fix` — reports fixed\n4. Run `gt doctor -v` again — same warnings reappear\n\n## Workaround\n\nNone — cosmetic issue, polecats function correctly despite the warning.\n\n## Environment\n\n- gt version: v0.8.0-58-g9f0902c2\n- bd version: 0.56.1 (28c406d5)\n- Platform: Linux 6.17.0-14-generic","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-gw9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"gt doctor: stale-beads-redirect for polecats recurs due to nested worktree structure","updated_at":"2026-02-24T12:50:59Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"gastown/crew/furiosa","await_id":"","await_type":"","close_reason":"Fixed in PR #1946: https://github.com/steveyegge/gastown/pull/1946","closed_at":"2026-02-23T16:47:12Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"f1596f7b55ce50fb6e801d78817eaba2eb2a263613f65b8169f557d55be9598a","created_at":"2026-02-23T13:05:19Z","created_by":"","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"dispatched_by: gastown/crew/furiosa\n\n## Bug\n\nThe `claude-settings` doctor check displays the fix hint:\n```\nRun 'gt doctor --fix' to delete stale files, then 'gt up --restart' to create new settings\n```\n\nBut `gt up --restart` doesn't exist. The available flags are `gt up --restore`.\n\nThe actual working fix is `gt doctor --fix --restart-sessions`.\n\n## Expected Behavior\n\nFix hint should say either:\n- `gt doctor --fix --restart-sessions`, OR\n- `gt up --restore` (if that's the intended workflow)\n\n## Actual Behavior\n\nHint references `--restart` flag which produces:\n```\nError: unknown flag: --restart\n```\n\n## Environment\n\n- gt version: 0.8.0 (faf45d1c)","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-iiu","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"gt doctor: claude-settings hint suggests nonexistent 'gt up --restart' flag","updated_at":"2026-02-23T16:47:12Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Not reproducing currently — will refile if it resurfaces","closed_at":"2026-02-25T11:08:17Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"d517f959d0743897f6fa7fd520fcfaa9d7fc06de6a0de38acbb34e8c1e1ef385","created_at":"2026-02-17T19:07:38Z","created_by":"dypt/witness","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Bug Report: MR beads created by gt done are silently lost\n\n**Observed:** During a 7-polecat swarm on dypt rig (2026-02-17 ~18:41-18:50), 2 of 7 MR beads created by gt done were not persisted to the Dolt database. The beads were referenced in POLECAT_DONE mail but return 'no issue found' when queried.\n\n**Missing beads:**\n- dypt-mzvw (MR for nitro/dypt-xh0.3.1, branch polecat/nitro/dypt-xh0.3.1@mlqxyxo6)\n- dypt-jk6s (MR for chrome/dypt-xh0.2.2, branch polecat/chrome/dypt-xh0.2.2@mlqxynfl)\n\n**Working beads (same session, same pattern):**\n- dypt-c9ot (rust), dypt-bjr5 (guzzle), dypt-bv96 (shiny), dypt-p0tt (thunder), dypt-t299 (fury)\n\n**Impact:** Refinery never saw the 2 missing MRs. Required manual cherry-pick intervention to merge the branches.\n\n**Hypothesis:** Transient Dolt server write failure under concurrent load. All 7 polecats ran gt done within ~10 minutes. The source issue beads (dypt-xh0.3.1, dypt-xh0.2.2) exist and are queryable - only the MR beads are missing. This suggests the write happened but wasn't committed/flushed.\n\n**Not the prefix routing bug** - these are dypt-prefixed beads queried from the dypt rig, which should route correctly. 5 of 7 identical operations succeeded.\n\n**Suggested investigation:**\n1. Check if gt done uses a transaction for MR bead creation\n2. Check Dolt server logs around 18:41-18:50 UTC for write errors\n3. Consider adding write verification (read-after-write) in gt done\n4. Consider retry logic for bead creation failures\n\n**Workaround used:** Refinery manually cherry-picked the branches and closed the source issues.\n\nFiled by: dypt/witness","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-jg1z","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"## Investigation (2026-02-17, gastown/crew/furiosa)\n\n### Root Cause: MergePolecatBranch timeout, not write failure\n\nThe MR beads were NOT lost — they are stranded on dead polecat Dolt branches that were never merged to main:\n- dypt-mzvw confirmed on branch `polecat-nitro-1771353218`\n- dypt-jk6s confirmed on branch `polecat-chrome-1771353205`\n\nBoth polecat branches also contain checkpoint labels (`done-cp:pushed`, `done-cp:mr-created`, `done-intent:COMPLETED`) confirming gt done ran through MR creation but failed at the Dolt merge step.\n\n### Timeline reconstruction from Dolt commit log\n\nThe merge script (MergePolecatBranch in doltserver.go) runs 5 SQL steps as a single connection:\n1. Flush main working set (DOLT_ADD + DOLT_COMMIT)\n2. DOLT_CHECKOUT to polecat branch\n3. Commit polecat final state (DOLT_ADD + DOLT_COMMIT)\n4. DOLT_CHECKOUT back to main\n5. DOLT_MERGE\n\nFor nitro and chrome, steps 1-3 succeeded (commits visible on main and polecat branches) but steps 4-5 never completed. Successful merges for other polecats took 550ms-1.2s. The gaps after the two failed flushes (~54s for nitro, ~60s for chrome) are consistent with the 30-second timeout in doltSQLScript (ctx context.WithTimeout 30*time.Second).\n\n| Polecat | Flush | Merge | Result |\n|---------|-------|-------|--------|\n| rust | 18:41:02 | 18:41:03 | OK |\n| nitro | 18:43:54 | never | FAILED |\n| guzzle | 18:44:48 | 18:44:49 | OK |\n| chrome | 18:46:50 | never | FAILED |\n| shiny | 18:47:50 | 18:47:51 | OK |\n| thunder | 18:48:12 | 18:48:13 | OK |\n| fury | 18:50:14 | 18:50:15 | OK |\n\nNote: timestamps are NOT concurrent (3+ minutes apart). This is not a race condition.\n\n### Prior fixes verified as working\n\n- PR #1299 (Dolt branch isolation, single-connection scripts): working — scripts run as one connection\n- PR #1594 (flush main working set before merge): working — flush commits visible in log\n- Neither fix prevents this failure mode (probable timeout under swarm load)\n\n### Secondary bug found: done.go checkpoint logic\n\ndone.go:821-825 writes `CheckpointDoltMerged: \"ok\"` unconditionally — even when `mergeFailed = true`. This means:\n1. Merge fails, warning printed, mergeFailed = true\n2. Checkpoint written as \"ok\" anyway\n3. If gt done retried, it would see the checkpoint and skip the merge permanently\n\nThis makes the failure non-recoverable via retry.\n\n### Resolution paths\n\n1. **Fix checkpoint bug (done.go:821-825)**: Only write CheckpointDoltMerged on success. Gate with `if !mergeFailed`.\n2. **Increase/remove timeout**: 30s in doltSQLScript may be too tight under swarm load. Make configurable or remove for merge scripts (they're idempotent and safe to run long).\n3. **Add merge retry at done.go level**: done.go:810 should retry the merge with backoff independently of doltSQLScriptWithRetry's internal retries.\n4. **Investigate Dolt server**: Need polecat tmux logs to confirm whether the actual error is a timeout, hang, or something else. The Dolt server may degrade under 7 concurrent polecats all writing.\n5. **Recovery for stranded beads**: The two polecat Dolt branches still exist and could be manually merged to main to recover the MR beads.","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"BUG: gt done creates MR beads that vanish from Dolt DB","updated_at":"2026-02-25T11:08:17Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"628efbe98dab916d8100153c75dbc697d47685055ac88671b494ea1c0d1fd04e","created_at":"2026-02-20T12:35:56Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Summary\n\nDuring epic delivery of dypt-d6t.4, polecats closed their task beads upon running `gt done`, before the refinery had merged the MR to the integration branch. The refinery should be the one closing task beads after successfully merging the MR.\n\n## Expected Behavior\n\n1. Polecat completes work → runs `gt done` → creates MR bead, pushes branch\n2. Refinery picks up MR → reviews → merges to integration branch → **refinery closes the task bead**\n\nThe task bead should remain open/in_progress until the code has actually landed.\n\n## Observed Behavior\n\nPolecats close the task bead themselves during `gt done`. This caused the epic-delivery dispatcher to see bead closures and attempt to sling dependent tasks before the code had landed on the integration branch. Dependents then couldn't find the files they needed.\n\nExample: dypt-d6t.4.3.1 (SuggestionBanner) was closed by guzzle, but the MR hadn't merged to integration/ai-template-recommender yet. Dependent tasks (4.3.2 skeleton, 4.3.4 tooltip) were slung and had to self-recover by cherry-picking from the polecat branch.\n\n## Impact\n\n- Bead status becomes unreliable as a signal for 'work has landed'\n- Dependency-based wave dispatch in epic delivery can sling tasks prematurely\n- Polecats working on dependent tasks have to improvise (rebase onto polecat branches, cherry-pick) instead of finding code on the integration branch\n\n## Investigation Notes\n\n- Check `gt done` code path — does it close the task bead directly?\n- Check refinery merge path — does it expect to close the task bead, or does it assume the polecat already did?\n- May be a recent regression — user notes this seems like new/changed behavior","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-k4r","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Polecats are closing task beads — should be the refinery after MR merge","updated_at":"2026-02-20T12:35:56Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"85d604cc2ea2fc92112f80968aa7b5721d60308d871517a7b6dde75bac674000","created_at":"2026-02-24T16:01:23Z","created_by":"gastown/crew/frodo","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Bug\n\nTestRunAgentsList_EmptyList_Output in internal/cmd/agents_test.go expects empty output but detects live crew members running in the workspace. The test is environment-dependent and fails in any Gas Town workspace with active crew sessions.\n\n## Reproduction\n\ngo test ./internal/cmd/ -run TestRunAgentsList_EmptyList_Output -v -count=1\n\n## Expected Behavior\n\nTest should either mock the tmux session list or skip when running inside an active workspace.\n\n## Actual Behavior\n\nagents_test.go:384: unexpected output from runAgentsList\n\n## Environment\n\n- Pre-existing on upstream/main","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-k97","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"TestRunAgentsList_EmptyList_Output fails in workspace with active crew","updated_at":"2026-02-24T16:01:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"67c6fefc60a67e9d230a09b40ca55abd3cf3aed0c4d2d1cf57b9354574846fd9","created_at":"2026-02-26T08:53:53Z","created_by":"","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Bug\n\nPolecat `rictus` was actively working on gt-zfv (test3.md creation) when the witness reassigned it to gt-8um. The in-flight work on gt-zfv was abandoned — no branch was pushed, no MR submitted. The bead remained hooked to rictus with notes showing \"Implemented\" but no deliverable.\n\n## Expected Behavior\n\nA polecat actively working on a task should not be reassigned to a different task. The witness should only assign idle/available polecats to new work.\n\n## Actual Behavior\n\nWitness reassigned rictus from gt-zfv to gt-8um while rictus was mid-execution. gt-zfv was orphaned with no pushed branch and no MR, requiring manual intervention.\n\n## Reproduction\n\n1. Sling multiple tasks to polecats in the same rig\n2. One task (gt-8um) enters a retry loop with multiple polecat failures\n3. Witness reassigns a polecat working on a different task to the retrying task\n4. Original task is orphaned\n\n## Workaround\n\nCheck for orphaned tasks after polecat storms. Manually re-sling or close.\n\n## Environment\n\n- gt version: v0.8.0-229-ge971ef24\n- bd version: 0.56.1\n- Platform: Linux 6.17.0-14-generic","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-map","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Witness reassigns polecat away from in-flight work, orphaning the original task","updated_at":"2026-02-26T08:54:13Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed upstream — target_branch removed from MergeQueueConfig, refinery uses rig default_branch","closed_at":"2026-02-19T23:05:06Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"088f9478b5cce692c6ddeba6bfc2642cddeb424ce11d10f6edd9369167c937aa","created_at":"2026-02-11T20:47:43Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"Two config fields exist for the same concept:\n\n- `default_branch` in rig config.json (auto-detected during gt rig add)\n- `target_branch` in settings/config.json merge_queue section\n\nThis creates confusion and a subtle bug: done.go reads default_branch from rig config, but the refinery reads target_branch from settings. They can disagree if only one is set.\n\nConsolidate to `default_branch` (the rig config field):\n\n1. Remove `target_branch` from MergeQueueConfig (internal/config/types.go)\n2. Refinery should read `rig.DefaultBranch()` directly\n3. Pass `default_branch` as a formula variable to refinery patrol so formulas can reference it\n4. Update all docs referencing target_branch\n5. Triple-check all uses/dependencies on target_branch across the codebase\n\nPrecedence after change: rig config.json default_branch \u003e fallback 'main'\n\nRolling into PR #1226 (integration branch feature).\n\nFiles to check:\n- internal/config/types.go (MergeQueueConfig.TargetBranch)\n- internal/refinery/engineer.go (NewEngineer, LoadSettingsConfig)\n- internal/cmd/done.go (already uses default_branch — good)\n- internal/cmd/prime_molecule.go (buildRefineryPatrolVars)\n- .beads/formulas/mol-refinery-patrol.formula.toml\n- docs/concepts/integration-branches.md\n- docs/reference.md","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-o4c","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Consolidate target_branch and default_branch into single default_branch","updated_at":"2026-02-19T23:05:06Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Obsolete: branch-per-polecat architecture was removed upstream (05b21d03, c6ce3a6c, fffd5585 — 2026-02-22). Polecats now write directly to main Dolt branch. MR beads are immediately visible to the refinery without merge.","closed_at":"2026-02-23T15:47:36Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"adc86b2bd90c4201130a3c3ff2a43ca64ae28a30c655d9ca42c78d18893e1e5a","created_at":"2026-02-09T19:03:36Z","created_by":"dypt/crew/neo","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Problem\n\nWhen a polecat completes work and runs `gt done`, the MR bead is created on the polecat's Dolt branch but NOT merged to the `main` Dolt branch. The refinery reads from `main` and cannot see the MR bead.\n\n## Impact\n\n- Refinery falls back to merging git branches directly to main instead of the integration branch\n- MR beads are orphaned on polecat Dolt branches\n- Manual intervention needed to cherry-pick MR beads to main\n\n## Reproduction\n\n1. Create integration branch for an epic\n2. Sling tasks to polecats (they get individual Dolt branches)\n3. Polecats complete work, submit MRs via `gt done`\n4. Refinery tries to process MRs but can't find the MR beads\n\n## Expected Behavior\n\n`gt done` / `gt mq submit` should ensure the MR bead is visible on the `main` Dolt branch before the polecat session is destroyed. Either:\n- Merge the polecat Dolt branch to main as part of `gt done`\n- Create the MR bead directly on the main Dolt branch rather than the polecat branch\n\n## Observed in\n\ndypt rig, wave 1 of dypt-4a2 epic. Polecats nitro, shiny, fury created MR beads (dypt-0zn9, dypt-8qey, dypt-30by) on their branches but refinery couldn't see them.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-ocj","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Polecat MR beads not merged to main Dolt branch on completion","updated_at":"2026-02-23T15:47:36Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Mock List now treats Label/Type as mutually exclusive, matching real impl. Commit a562e15a.","closed_at":"2026-02-13T10:27:22Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"a6ae82dd9896b6577238c6bfdf18794bbc743abb6c330ba15e4b8244434f0695","created_at":"2026-02-13T09:29:05Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"The mock List method in mq_testutil_test.go applies Type and Label as independent filters. Real beads.List at internal/beads/beads.go:306-312 treats them as mutually exclusive -- if Label is set, Type is ignored entirely.\n\nIf a caller passes both Label and Type in ListOptions, the mock would filter on both (more restrictive) while production would only filter on Label.\n\nLow risk: no current caller passes both fields. Found during PR #3 (MT-1) review.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-p9m","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Mock beads.List filters Type and Label independently, real implementation treats them as mutually exclusive","updated_at":"2026-02-13T10:27:22Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed upstream — commits-ahead logic reworked","closed_at":"2026-02-19T23:04:05Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"72d3bb30bffc397aad756780bef5b9c013e9e09dbb4011b52f2e7f9a5f29c989","created_at":"2026-02-12T17:31:36Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-pdk","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"gt mq integration status reports 0 commits ahead when actually 1 ahead (non-main base branch)","updated_at":"2026-02-19T23:04:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"042e7fa308cbd1f1bf28364fc8354b12a59adecb1038828dfcc65554e55f7827","created_at":"2026-02-26T08:53:52Z","created_by":"","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Bug\n\nAfter force-closing bead gt-8um (whose MR was already merged to the integration branch), the witness continued spawning polecats to work on it. 24 polecats were allocated in total, 9 running concurrently, all targeting the closed bead. Had to park the rig to stop the flood.\n\n## Expected Behavior\n\nWitness should check bead status before dispatching. If a bead is closed, it should not be re-dispatched regardless of other signals (open molecules, convoy membership, etc.).\n\n## Actual Behavior\n\nWitness ignored the closed status and kept spawning polecats. The flood continued until the rig was manually parked.\n\n## Reproduction\n\n1. Create an epic with a leaf task, sling to polecat\n2. Multiple polecats fail/retry on the task, eventually one submits an MR\n3. Refinery merges the MR but the bead stays open (stale molecule blocks closure)\n4. Force-close the bead with `bd close \u003cid\u003e --force`\n5. Witness continues spawning polecats for the now-closed bead\n\n## Workaround\n\nPark the rig (`gt rig park \u003crig\u003e`) to stop the witness.\n\n## Environment\n\n- gt version: v0.8.0-229-ge971ef24\n- bd version: 0.56.1\n- Platform: Linux 6.17.0-14-generic","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-r9w","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Witness spawns polecat storm on closed bead — doesn't check bead status before re-dispatching","updated_at":"2026-02-26T08:54:06Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Not reproducing currently — will refile if it resurfaces","closed_at":"2026-02-25T11:06:20Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5cb1fa11564844e25485dc40465fcef95b9b49a0a9b85cfe6a90133ccb3d6cd1","created_at":"2026-02-19T23:07:22Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"When a polecat completes its merge, it sends a message to the witness. The witness correctly receives the message and identifies the merge request, but never prods the refinery to process it. The MR sits until the refinery happens to poll on its own.\n\nTwo fixes needed:\n\n1. **Polecat should notify both witness AND refinery on merge completion.** Currently only the witness is messaged. The refinery should receive a direct nudge so it can immediately pick up the new MR without waiting for its next poll cycle.\n\n2. **Witness should periodically nudge the refinery during patrol.** As a safety net, the witness patrol loop should include a step that checks whether the refinery has pending MRs and nudges it if so. This ensures MRs don't get stranded even if the direct notification from the polecat is missed (e.g. refinery was restarting).\n\nNote: upstream added `feat(refinery): nudge deacon after merge to check stranded convoys` (commit a0c469c4) which is related but addresses convoys, not the initial MR pickup.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-ra5","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Polecat merge completion doesn't reliably reach refinery","updated_at":"2026-02-25T11:06:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Root cause identified: upstream bd bug — bd show/agent state cannot find ephemeral beads (bd-hze6, https://github.com/steveyegge/beads/issues/2053). No gt fix needed; resolves once bd fixes single-bead lookup to include ephemeral=true rows.","closed_at":"2026-02-23T15:46:12Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"d91d6f281c35972f2943a1d0cfcf7a6545e0548f547b718256fa402f0a89bbb0","created_at":"2026-02-23T13:12:25Z","created_by":"xexrcom/crew/deckard","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Summary\n\nWhen slinging work to a polecat, the SetAgentState call fails transiently with:\n\n```\nWarning: SetAgentState attempt 2 failed, retrying in 1.094061998s: updating agent state: issue not found\n```\n\nThe polecat eventually starts successfully after retries, but the warning suggests a race condition — the agent bead may not be fully committed/visible in the database when SetAgentState first fires.\n\n## Reproduction\n\n1. Have a rig with polecats configured (e.g., xexrcom)\n2. `gt sling \u003cbead-id\u003e \u003crig\u003e --no-convoy`\n3. Observe the \"issue not found\" warning in output during spawn\n\n## Expected Behavior\n\nSetAgentState should find the agent bead on the first attempt, or the bead should be created/ensured before SetAgentState is called.\n\n## Actual Behavior\n\nSetAgentState fails 1-2 times with \"issue not found\" before succeeding on retry. The polecat does start, but the warnings are confusing and suggest a timing issue.\n\n## Environment\n\n- Dolt server on localhost:3307\n- Multiple polecats spawning concurrently\n- Agent beads exist in the database (confirmed via `bd list --type agent`)","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-rct","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"SetAgentState retries with 'issue not found' during polecat spawn","updated_at":"2026-02-23T15:46:12Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"89b900198e011ce50d68a15d96c3d2224258e43fc7137f23f2c21445951ad74a","created_at":"2026-02-05T09:28:03Z","created_by":"xexr","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"Rig identity bead for gastown.\n\nrepo: https://github.com/Xexr/gastown\nprefix: gt\nstate: active","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-rig-gastown","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"gastown","updated_at":"2026-02-23T16:14:54Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"test cleanup","closed_at":"2026-02-23T16:21:11Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9cc493b68fe8c59386803a17baba2aeb69002eecd34d37aecf4c3ff5cb8ee480","created_at":"2026-02-23T16:20:31Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-test-e6o-a","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Child task A (inside epic)","updated_at":"2026-02-23T16:21:11Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"test cleanup","closed_at":"2026-02-23T16:21:11Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0bebdcf0daa607225cb34da93b4a54bcfac20d67f8d19be6e4474d152aab7f4b","created_at":"2026-02-23T16:20:31Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-test-e6o-b","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Child task B (inside epic)","updated_at":"2026-02-23T16:21:11Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"test cleanup","closed_at":"2026-02-23T16:21:11Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0025e20877110dbd4cda73441c3d1da054ef2b625fc4bc6fb323273b1d80ae66","created_at":"2026-02-23T16:20:26Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-test-e6o-epic","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Test epic for gt-e6o validation","updated_at":"2026-02-23T16:21:11Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"test cleanup","closed_at":"2026-02-23T16:21:11Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dd6a9f0b9e6e539e996e34b86e23a100ce9025a2b03f8d936c6e6d3bf6f6a61a","created_at":"2026-02-23T16:20:31Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-test-e6o-outside","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Unrelated task (outside epic)","updated_at":"2026-02-23T16:21:11Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"test cleanup","closed_at":"2026-02-23T16:22:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4388a98afa7db7d4196149070ddb972b593cb6635f6f2f6c9c942819cba79670","created_at":"2026-02-23T16:22:20Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-test-parent-1","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"test parent flag","updated_at":"2026-02-23T16:22:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"test cleanup","closed_at":"2026-02-23T16:22:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"8883d0727130185773c8dc836f72b9c4fbf15f19d4a45de41ee5d18ab7fabb6c","created_at":"2026-02-23T16:22:20Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-test-parent-2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"test child via --parent","updated_at":"2026-02-23T16:22:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"gastown/crew/aragorn","await_id":"","await_type":"","close_reason":"Fixed in PR #1984: https://github.com/steveyegge/gastown/pull/1984","closed_at":"2026-02-24T13:56:14Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4c7d05b443fccb076f9e89477c81689654405e047bba377a1c05d24c2bec6032","created_at":"2026-02-24T12:12:41Z","created_by":"","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Bug\n\n`gt doctor --fix` reports 'agent-beads-exist: N agent bead(s) missing' and attempts to create them, but silently fails for 3 beads rig crew members. The fix hint says 'Run gt doctor --fix to create missing agent beads' but provides no error when creation fails.\n\n## Expected Behavior\n\nEither successfully create the missing agent beads, or report a clear error explaining why creation failed (e.g., permission issue, missing rig config, routing failure).\n\n## Actual Behavior\n\nFirst --fix pass: reduces from 7 missing to 3 missing (creates 4, fails on 3 silently).\nSubsequent --fix passes: stuck at 3 missing. No error, no explanation.\n\nMissing agent beads:\n- bd-beads-crew-korben\n- bd-beads-crew-ruby\n- bd-beads-crew-zorg\n\nAll three clones exist at `/home/xexr/gt/beads/crew/{korben,ruby,zorg}`, all on `main` branch.\n\n## Reproduction\n\n1. Have beads rig crew members without agent beads\n2. Run `gt doctor --fix`\n3. Observe some agent beads created but korben/ruby/zorg fail silently\n4. Run `gt doctor --fix` again — same 3 remain missing\n\n## Workaround\n\nNone identified.\n\n## Environment\n\n- gt version: v0.8.0-58-g9f0902c2\n- bd version: 0.56.1 (28c406d5)\n- Platform: Linux 6.17.0-14-generic","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-uaq","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"gt doctor --fix: agent-beads-exist fix fails silently for beads rig crew","updated_at":"2026-02-24T13:56:14Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Beads PR #1903 merged 2026-02-20. Standalone expansion formula support landed in bd. No gt-side changes needed.","closed_at":"2026-02-23T16:14:04Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"02d04e3d6aa9591d559a8937fb116b6bbc28cba60a4019727dc125f2a443da4a","created_at":"2026-02-19T23:07:11Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"Currently, expansion formulas can only be run via a wrapping formula that uses Compose. If a user has all the required variables for an expansion formula, they should be able to invoke it directly (e.g. `gt mol start \u003cexpansion-formula\u003e --var key=value`). The system should detect that it's an expansion formula, perform the expand on the fly with the provided variables, and execute the result. This removes the need to create boilerplate Compose wrappers just to run a single expansion formula.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-vyb","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"## Beads PR Submitted (2026-02-20)\n\nPR: https://github.com/steveyegge/beads/pull/1903\nBead: bd-qzb (beads rig)\n\nStandalone expansion formula support implemented in bd. Validated locally — both `rule-of-five` (no vars) and `spec-brainstorm-expansion` (with vars) correctly generate child step beads.\n\nAlso fixed a false-positive var detection issue in `spec-brainstorm-expansion.formula.toml` where example text used `{{client_name}}` / `{{due_date}}` syntax (committed to town root).\n\n**Status:** Waiting for PR #1903 to merge. Once merged and bd updated, this bead can be closed — no gt-side changes needed.","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Allow direct execution of expansion formulas without Compose wrapper","updated_at":"2026-02-23T16:14:04Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"1f873cd5671f59ca421ed010512263f8030a5a3393470c2a4a39ae043ab88b4a","created_at":"2026-02-25T10:07:40Z","created_by":"gastown/crew/frodo","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Bug\n\nThe `claude-settings` check flags `~/gt/CLAUDE.md` as \"wrong location\" but `--fix` skips it because it's tracked in git. This creates a permanent unfixable failure — doctor always reports an error that it can never resolve.\n\n## Root Cause\n\nTwo independent heuristics that don't agree:\n\n1. **Detection** (`Run`): Uses `isIdentityAnchor()` which exempts files that are \u003c20 lines and contain \"gt prime\". Files exceeding 20 lines are flagged as \"wrong location\" regardless of git status.\n\n2. **Fix** (`Fix`): Skips files with `gitStatusTrackedClean` or `gitStatusTrackedModified` because deleting tracked files modifies the customer repo.\n\nThe detection doesn't consider git-tracked status, so it flags files that the fix will never touch.\n\n## Trigger\n\nAdding project-wide conventions to `~/gt/CLAUDE.md` (e.g., \"Common Errors to Avoid\" section) pushes the file past the 20-line threshold. The file still contains \"gt prime\" and is still a legitimate identity anchor — it just also has useful content.\n\n## Expected Behavior\n\nIf `--fix` won't touch a file (because it's tracked), the check shouldn't flag it as a failure. The check and fix should use consistent criteria. Options:\n\n1. **Check respects git status**: If tracked and clean, don't flag it. This matches fix behavior and is the most internally consistent.\n2. **Smarter content detection**: Instead of a line count heuristic, check whether the content contains Mayor-specific instructions that would actually pollute child workspaces (the original concern).\n3. **Downgrade to warning**: If the file can't be auto-fixed, report a warning not a failure.\n\nOption 1 is simplest and eliminates the unfixable-failure antipattern.\n\n## Reproduction\n\n1. Edit `~/gt/CLAUDE.md` to add project conventions (file exceeds 20 lines)\n2. Commit the file\n3. Run `gt doctor -v` — claude-settings fails\n4. Run `gt doctor --fix` — skips the file (\"tracked in customer repo, skipping\")\n5. Run `gt doctor -v` again — still fails, permanently\n\n## Environment\n\n- gt version: v0.8.0-164-g18c5b34d\n- bd version: 0.56.1\n- Platform: Linux","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-x39","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"gt doctor: claude-settings check and fix disagree on tracked CLAUDE.md at town root","updated_at":"2026-02-25T10:07:40Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in PR #1993: https://github.com/steveyegge/gastown/pull/1993","closed_at":"2026-02-24T16:52:20Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"43182f4571d6c6b563060e4eeeabce644a5b1a915e0b27f350dda9cfe8bfcb40","created_at":"2026-02-24T16:00:49Z","created_by":"gastown/crew/gandalf","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Summary\n\nRunning the full test suite (or possibly gt doctor --fix) creates 20+ stale Dolt databases and orphaned rig folders in the production town home (~/gt). These accumulate across runs and are never cleaned up.\n\n## Observed State\n\nAfter test runs, ~/gt/.dolt-data/.dolt_dropped_databases/ accumulates dozens of entries:\n- **testdb_\u003chash\u003e**: 15+ databases with hash suffixes (e.g., testdb_103cc5097dcc1f57)\n- **beads_pt\u003chash\u003e**: 12+ polecat test databases (e.g., beads_pt232da056)\n- **beads_test**, **beads_tr**, **beads_gt**: test databases with .backup.* variants\n- **beads_bd-doctor-test**: doctor test database with backups\n- **testdb**: base test database with backups\n\nTotal: 49 dropped databases observed after recent test runs.\n\nThe rig folders issue may be secondary — databases created on the production Dolt server (port 3307) could trigger rig directory creation when other code iterates `SHOW DATABASES` and tries to find/create matching rig dirs.\n\n## Root Cause Analysis\n\n### Source 1: patrol_helpers_test.go — beads_pt\u003chash\u003e databases\n- `setupPatrolBD()` creates databases with random prefixes: `beads_pt` + 4 random hex bytes\n- Has t.Cleanup() that DROPs the database, BUT:\n  - Cleanup connects to the test port — if it differs from where the DB was created, cleanup misses it\n  - DROP moves databases to .dolt_dropped_databases rather than truly deleting them\n  - `dolt_purge_dropped_databases()` is never called after cleanup\n\n### Source 2: beads_db_init_test.go — beads_\u003cprefix\u003e databases\n- Creates databases with 12+ different prefixes (existing-prefix, empty-prefix, real-prefix, etc.)\n- Has a `cleanStaleBeadsDatabases()` helper with 4-pronged cleanup strategy\n- Known issue: cleanup list (`knownPrefixes`) may not cover all test prefixes\n- Physical cleanup removes dirs from data-dir but may not purge Dolt catalog\n\n### Source 3: testdb_\u003chash\u003e databases — origin unknown\n- 15 databases with hash suffixes in dropped_databases\n- Code in dolt.go explicitly skips `testdb_` prefixed databases (line 1405) suggesting these are a known leak\n- Source creation point not found in test code — may come from bd init or another integration path\n\n### Source 4: Shared vs production server confusion\n- If production Dolt server is running on 3307 when tests start, RequireDoltServer() may reuse it\n- Test databases then get created on the PRODUCTION server's data-dir (~/gt/.dolt-data/)\n- When test server infrastructure creates its own isolated server, cleanup only targets that server\n\n### Source 5: dolt_purge_dropped_databases() not called\n- DROP DATABASE in Dolt moves databases to .dolt_dropped_databases/ — does not delete them\n- The 49 accumulated entries in .dolt_dropped_databases/ suggest purge is never called after test cleanup\n- This is the likely reason files accumulate even when SQL-level DROP succeeds\n\n## Investigation TODO\n\n1. [ ] Run `pnpm test:run` with a clean town home and monitor what gets created in ~/gt/.dolt-data/\n2. [ ] Determine whether tests connect to production server (3307) or isolated test server\n3. [ ] Trace origin of testdb_\u003chash\u003e database creation\n4. [ ] Check if gt doctor --fix creates databases on production server\n5. [ ] Verify cleanup code calls dolt_purge_dropped_databases() after DROP\n\n## Fix Strategy\n\n1. **Ensure test server isolation**: Tests must NEVER write to the production Dolt data-dir. If GT_DOLT_PORT is not set and port 3307 is listening, tests should start their own isolated server rather than reusing production.\n\n2. **Add dolt_purge_dropped_databases()**: After each test's DROP DATABASE cleanup, call purge to prevent accumulation in .dolt_dropped_databases/\n\n3. **Add a TestMain cleanup sweep**: At the end of each test binary, sweep for any beads_*, testdb_* databases that leaked and drop+purge them\n\n4. **Fix knownPrefixes list**: Ensure all test prefixes are covered in cleanStaleBeadsDatabases()\n\n5. **Consider gt doctor --fix --no-start**: When running doctor fix, use --no-start to prevent daemon startup which may create databases\n\n## Labels\n\ntest-cleanup, dolt, infrastructure","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-xpd","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Test suite leaks Dolt databases and rig folders into production town home","updated_at":"2026-02-24T16:52:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"1d9a204bae631f8ff126206cb092042d82bb6e95f920df0566c170cd163106ea","created_at":"2026-02-18T17:39:45Z","created_by":"dypt/crew/neo","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-xzkg","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"gt mq integration land should warn or push when local branch is ahead of origin","updated_at":"2026-02-18T17:39:45Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"gastown/crew/gandalf","await_id":"","await_type":"","close_reason":"Fixed in PR #1987: https://github.com/steveyegge/gastown/pull/1987","closed_at":"2026-02-24T15:06:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"1af5c1b9dbf7d2b6402f34731c1115823776ea0897a8d1540596d830c08a93b3","created_at":"2026-02-24T12:12:38Z","created_by":"","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"## Bug\n\nWhen `gt doctor --fix --restart-sessions` fixes stale `claude-settings`, the daemon restarts sessions that regenerate `settings.json` files without proper PATH exports. The next doctor run reports them as stale again, creating an infinite fix/recreate cycle.\n\n## Expected Behavior\n\nAfter `--fix --restart-sessions`, newly created sessions should have `settings.json` files with correct PATH exports (including `~/.local/bin` for gt/bd binaries).\n\n## Actual Behavior\n\n`--fix` deletes 9 stale settings.json files (marketplace/{witness,refinery,crew,polecats}, xexrcom/{witness,refinery,crew,polecats}, events/refinery). Daemon recreates sessions with settings.json files that still lack PATH exports. Next doctor run reports all 9+ as stale again.\n\n## Reproduction\n\n1. Run `gt doctor --fix --restart-sessions` — shows claude-settings as fixed\n2. Run `gt doctor -v` immediately after — reports 10 stale Claude config files again\n3. The 9 settings.json files all show 'missing PATH export'\n\n## Workaround\n\nNone — the cycle repeats every fix pass. The settings are functional but perpetually flagged.\n\n## Environment\n\n- gt version: v0.8.0-58-g9f0902c2\n- bd version: 0.56.1 (28c406d5)\n- Platform: Linux 6.17.0-14-generic","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-y22","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"gt doctor --fix: session creation produces settings.json without PATH exports (fix/recreate cycle)","updated_at":"2026-02-24T15:06:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Confirmed: docs/reviews/ never existed on feat/integration-branch-enhancement. Files removed from fork main in 431357dc, archived to gists.","closed_at":"2026-02-13T15:28:15Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ad23e797729fb6acb2fdc6deb76aa901881dcf317d6b6474b36f46ae7c78a26b","created_at":"2026-02-13T09:47:24Z","created_by":"gastown/crew/furiosa","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"docs/reviews/pr-1226-integration-branch-review.md, docs/reviews/pr1226-fork-pr-reviews.md, and docs/reviews/pr1226-review-tracking.md are working documents for our review process. They are referenced from PR comments and useful during review, but should not be merged upstream.\n\nDelete these files (or the entire docs/reviews/ directory) before the final squash commit. Also check for test-target-branch-*.sh scripts (untracked) that should not be committed.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-z08","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Remove review documents before final squash","updated_at":"2026-02-13T15:28:15Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":"gastown/polecats/rictus","await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-26T08:52:32Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"77d7fbb3c8012135afccaa8399947d38242af6b08d1642c4390c0dd707e422ed","created_at":"2026-02-26T08:33:29Z","created_by":"gastown/crew/gandalf","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"attached_molecule: gt-wisp-cf21\nattached_at: 2026-02-26T08:34:41Z\ndispatched_by: gastown/crew/gandalf\n\n## Task\n\nCreate a file at `TEST_DOCS/test3.md` in the repo root with the following content:\n\n```markdown\n# Polecat Smoke Test 3\n\n- **Date:** (current date/time)\n- **Agent:** (your agent identity)\n- **Status:** PASS\n\nThis file was created by a polecat to verify the dispatch-execute-merge pipeline works end-to-end.\n```\n\n## Acceptance Criteria\n\n1. `TEST_DOCS/test3.md` exists and contains the above content (with actuals filled in)\n2. File is committed to the feature branch\n3. `gt done` is called to submit to refinery","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-zfv","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"Implemented: Created TEST_DOCS/test3.md with polecat smoke test results (date, agent identity, PASS status)","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Create TEST_DOCS/test3.md with polecat smoke test results","updated_at":"2026-02-26T08:52:32Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"1a3471f38e8e8f47d778c438905b144bc64db8a26d3b77857f7486f857756a00","created_at":"2026-02-26T08:35:55Z","created_by":"gastown/refinery","crystallizes":0,"defer_until":null,"delete_reason":"","deleted_at":null,"deleted_by":"","description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"gt-zhk","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"original_type":"","owner":"xexr@xexr.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Pre-existing: TestGetConvoyTrackedIssues_CrossRigFallback fails on main (oag-19dd9 not found)","updated_at":"2026-02-26T08:35:55Z","waiters":"","wisp_type":"","work_type":""}
